{"version":3,"file":"changefocus.min.js","sources":["../src/changefocus.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript change opaque question focus.\n *\n * @package   mod_quiz\n * @copyright 2017 The Open University\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since     3.2\n */\ndefine(['jquery'], function($) {\n    /**\n     * @alias module:mod_quiz/attempt\n     */\n    var t = {\n        init : function() {\n            $( document ).ready(function() {\n                var checkButton = $('input[id*=\"_omact_gen_\"]');\n                var opaqueTryAgainButton = $('input[id*=\"omact_ok\"]');\n\n                var lastindex = localStorage.getItem('last_question_index');\n                localStorage.removeItem('last_question_index');\n                /* Check if last question is set */\n                if (lastindex !== null) {\n                    // Because we got timeout inside inline script so we need to wait for that timeout.\n                    setTimeout(function () {\n                        // Scroll to last checked question.\n                        $('html, body').animate({\n                            scrollTop: $('#q' + lastindex).offset().top\n                        }, 100);\n\n                        // Focus on \"Try again\" button if exist otherwise blur all other button.\n                        var focusTryAgainButton = $('input[id*=' + '\":' + lastindex + '_omact_ok\"' + ']');\n                        if ($(focusTryAgainButton).length > 0) {\n                            $(focusTryAgainButton).focus();\n                        } else {\n                            $('input[id*=\"_omact_ok\"]').blur();\n                        }\n                    }, 350);\n                }\n\n                opaqueTryAgainButton.on('keydown', function (e) {\n                    var keyCode = e.keyCode || e.which;\n                    e.preventDefault();\n                    // Tab on Try again button.\n                    if (keyCode == 9 && !e.shiftKey) {\n                        var slot = t.getQuestionIndex(e);\n                        $('#q' + slot + ' input.questionflagimage').focus();\n                        $(this).attr('tabindex', -1);\n                    }\n                });\n\n                // Check button clicked.\n                $(checkButton).click(function (e) {\n                    localStorage.setItem('last_question_index', t.getQuestionIndex(e));\n                });\n\n                // Try again button clicked.\n                $(opaqueTryAgainButton).click(function (e) {\n                    localStorage.setItem('last_question_index', t.getQuestionIndex(e));\n                });\n            });\n        },\n        getQuestionIndex: function (e) {\n            // Save last position to scroll back to that question when the page is re-rendered.\n            var str = e.target.id;\n            var questionindex = str.substr(str.indexOf(':') + 1);\n            questionindex = questionindex.substr(0, questionindex.indexOf('_'));\n            return questionindex;\n        }\n    };\n    return t;\n});\n"],"names":["define","$","t","init","document","ready","checkButton","opaqueTryAgainButton","lastindex","localStorage","getItem","removeItem","setTimeout","animate","scrollTop","offset","top","focusTryAgainButton","length","focus","blur","on","e","keyCode","which","preventDefault","shiftKey","slot","getQuestionIndex","this","attr","click","setItem","str","target","id","questionindex","substr","indexOf"],"mappings":";;;;;;;;AAuBAA,kCAAO,CAAC,WAAW,SAASC,OAIpBC,EAAI,CACJC,KAAO,WACHF,EAAGG,UAAWC,OAAM,eACZC,YAAcL,EAAE,4BAChBM,qBAAuBN,EAAE,yBAEzBO,UAAYC,aAAaC,QAAQ,uBACrCD,aAAaE,WAAW,uBAEN,OAAdH,WAEAI,YAAW,WAEPX,EAAE,cAAcY,QAAQ,CACpBC,UAAWb,EAAE,KAAOO,WAAWO,SAASC,KACzC,SAGCC,oBAAsBhB,EAAE,eAAsBO,UAAtB,eACxBP,EAAEgB,qBAAqBC,OAAS,EAChCjB,EAAEgB,qBAAqBE,QAEvBlB,EAAE,0BAA0BmB,SAEjC,KAGPb,qBAAqBc,GAAG,WAAW,SAAUC,OACrCC,QAAUD,EAAEC,SAAWD,EAAEE,SAC7BF,EAAEG,iBAEa,GAAXF,UAAiBD,EAAEI,SAAU,KACzBC,KAAOzB,EAAE0B,iBAAiBN,GAC9BrB,EAAE,KAAO0B,KAAO,4BAA4BR,QAC5ClB,EAAE4B,MAAMC,KAAK,YAAa,OAKlC7B,EAAEK,aAAayB,OAAM,SAAUT,GAC3Bb,aAAauB,QAAQ,sBAAuB9B,EAAE0B,iBAAiBN,OAInErB,EAAEM,sBAAsBwB,OAAM,SAAUT,GACpCb,aAAauB,QAAQ,sBAAuB9B,EAAE0B,iBAAiBN,WAI3EM,iBAAkB,SAAUN,OAEpBW,IAAMX,EAAEY,OAAOC,GACfC,cAAgBH,IAAII,OAAOJ,IAAIK,QAAQ,KAAO,UAClDF,cAAgBA,cAAcC,OAAO,EAAGD,cAAcE,QAAQ,eAI/DpC"}